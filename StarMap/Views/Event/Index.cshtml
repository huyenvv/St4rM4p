@model PagedList.IPagedList<StarMap.Models.Event>
@using Resources
@using StarMap.Utilities

@{
    ViewBag.Title = Resources.EventList;
    var lang = StarMap.Helpers.CultureHelper.GetCurrentCulture(true);
    var format = lang.Equals("vi") ? "DD/MM/YYYY" : "MM/DD/YYYY";
}
<link href="/Content/bootstrap-datetimepicker.css" rel="stylesheet" />
<h3 class="page-header">@ViewBag.Title</h3>
<div class="row">
    <div class="col-md-12">
        @Html.ActionLink(Resources.Create, "NewOrEdit", null, new { Class = "btn btn-primary" })
    </div>
</div>
<br />
<div class="row filterBox">
    @using (Html.BeginForm())
    {
        bool? status = ViewBag.status != null ? bool.Parse(ViewBag.status.ToString()) : null;
        bool? isHot = ViewBag.isHot != null ? bool.Parse(ViewBag.isHot.ToString()) : null;
        <div class="col-md-2">
            <label>@Resources.Category</label>
            @Html.DropDownList("cateId", ViewBag.categoryList as SelectList, Resources.All, new { Class = "form-control" })
        </div>
        <div class="col-md-2">
            <label>@Resources.Status</label>
            <select name="status" class="form-control">
                <option value="">@Resources.All</option>
                <option value="true" @(status == true ? "selected" : "")>Active</option>
                <option value="false" @(status == false ? "selected" : "")> Inactive</option>
            </select>
        </div>
        <div class="col-md-2">
            <label>Hot</label>
            <select name="isHot" class="form-control">
                <option value="">@Resources.All</option>
                <option value="true" @(isHot == true ? "selected" : "")>Hot</option>
                <option value="false" @(isHot == false ? "selected" : "")> Not Hot</option>
            </select>
        </div>
        <div class="col-md-2">
            <label>@Resources.StartDate</label>
            <input type="text" name="startDate" value="@Common.GetLocaleDateTime(ViewBag.startDate, lang)" class="form-control" id="startDate" />
        </div>
        <div class="col-md-2">
            <label>@Resources.EndDate</label>
            <input type="text" name="endDate" value="@Common.GetLocaleDateTime(ViewBag.endDate, lang)" class="form-control" id="endDate" />
        </div>
        <div class="col-md-3">
            <label>@Resources.SearchText</label>
            <input type="text" name="searchText" value="@ViewBag.searchText" class="form-control" />
        </div>
        <div class="col-md-1">
            <label></label>
            <input type="submit" name="submit" value="@Resources.Search" class="btn btn-primary" />
        </div>
    }
</div>
<br />
<table class="table">
    <tr>
        <th>
            @Resources.Name
        </th>
        <th>
            @Resources.EventDate
        </th>
        <th>
            @Resources.Location
        </th>
        <th>
            @Resources.Category
        </th>
        <th>
            @Resources.Address
        </th>
        <th>
            @Resources.Status
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @if (item.StartDate.HasValue)
                {
                    @Html.DisplayFor(modelItem => item.StartDate)
                }
                else
                {
                    @Resources.Undefined
                } -
                <br />
                @if (item.EndDate.HasValue)
                {
                    @Html.DisplayFor(modelItem => item.EndDate)
                }
                else
                {
                    @Resources.Undefined
                }
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Location)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Category.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Address)
            </td>
            <td>
                @if (item.IsActive)
                {
                    <label class="label label-success"><i class="glyphicon glyphicon-ok"></i> @Resources.Active</label>
                }
                else
                {
                    <label class="label label-danger"><i class="glyphicon glyphicon-remove"></i> @Resources.Inactive</label>
                }
            </td>
            <td>
                <a href="@Url.Action("NewOrEdit", new {id = item.Id})" class="btn btn-default  btn-xs"><i class="glyphicon glyphicon-pencil"></i> @Resources.Edit</a>
                <a href="@Url.Action("Delete", new {id = item.Id})" class="btn btn-danger  btn-xs confirmDelete"><i class="glyphicon glyphicon-remove-circle"></i> @Resources.Delete</a>
            </td>
        </tr>
    }

</table>
@Html.Partial("_Paging", Model)
@section Scripts {
    <script src="~/Scripts/moment-with-locales.js"></script>
    <script src="~/Scripts/bootstrap-datetimepicker.js"></script>
    <script>
        $(document).ready(function () {
            $('#endDate').datetimepicker({
                locale: '@lang',
                useCurrent: false,
                showClear: true
            });

            $("#startDate").datetimepicker({
                locale: '@lang',
                useCurrent: false,
                showClear: true
            }).on("dp.change", function (e) {
                var startDate = new Date(e.date);
                var endDate = $('#endDate').data("DateTimePicker").date();
                $('#endDate').data("DateTimePicker").minDate(e.date);
                if (endDate < startDate) {
                    $('#endDate').data("DateTimePicker").date(startDate);
                }
            });
        });
    </script>
}